# 2026-02-27 ‚Äî Cross-Instance Communication Operational

## Cross-Instance Agent Comms (B.O.B. ‚Üî Cornerstone) ‚úÖ

### What We Built
- **Problem:** Direct API-to-API (Tailscale) failed due to gateway bind issues (loopback stuck)
- **Solution:** Convex message bus (database-backed, works offline, no network config)
- **Status:** DEPLOYED AND WORKING

### Technical Implementation
- **Schema:** `agentMessages`, `agentPresence`, `agentLearnings` tables in Convex
- **Functions:** 9 CRUD operations in `convex/agentComms.ts`
  - sendMessage, getMessagesForAgent, markMessageRead
  - heartbeat, getAgentPresence
  - recordLearning, getLearnings, markLearningApplied
- **Deployment:** dashing-coyote-31 (Convex cloud)

### First Test
- B.O.B. heartbeat sent: online, camp-macbook, capabilities [ollama, web-search, convex]
- Test message sent to Cornerstone (was scout, corrected)
- Message queued in Convex, ready for Cornerstone to read

### Org Chart Clarification
```
BILLY (Human) üßë‚Äçüíº
    ‚îÇ
    ‚îú‚îÄ‚îÄ B.O.B. ü¶¶ (Intel Mac) ‚îÄ‚îÄ‚îê
    ‚îÇ                            ‚îú‚îÄ‚îÄ Same Team (peers)
    ‚îî‚îÄ‚îÄ Cornerstone ü™® (M1 Mac) ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îî‚îÄ‚îÄ SCOUT + 8 agents (internal to Cornerstone)
```
- B.O.B. and Cornerstone are PEERS
- Both serve Billy directly
- No chain of command between agents
- Human has ultimate decision-making power (kill switch/override)
- Redundancy: if one agent breaks, the other can help

### What B.O.B. Can Now Do
- Send messages to Cornerstone via Convex
- Check Cornerstone's online status
- Share learnings (security, automation, config tips)
- Queue messages when Cornerstone offline
- Heartbeat every 5 minutes

### Key Lessons Learned
1. **Sometimes the workaround IS the solution** ‚Äî Convex message bus > direct HTTP
2. **Gateway bind issues are hell** ‚Äî plist caching ignores config changes
3. **Document the "why" not just the "what"** ‚Äî SOUL.md updated with communication patterns

### Files Changed
- `ai-town/convex/schema.ts` ‚Äî 3 new tables
- `ai-town/convex/agentComms.ts` ‚Äî 9 functions
- `SOUL.md` ‚Äî Added Agent Communication section
- All committed to GitHub (warrior7702/B.O.B)

## AI Town Still Running
- http://localhost:5173/ai-town
- AI agents wandering and chatting
- Uses same Convex backend (dashing-coyote-31)

## Next Steps
- Cornerstone to test message reception
- First cross-instance learning exchange
- Potential: automated heartbeat polling

## Evening Session Updates (11:11 PM)

### Security Monitoring (P3) ‚úÖ COMPLETE
- **SSH brute force monitor:** Every 10 minutes, Telegram alerts
- **Disk space monitor:** Every hour (currently 2% usage - healthy)
- **Config audit:** Daily at 9 AM, baselines tracked
- **Status:** All cron jobs active since Feb 26, logging to cron.log

### Backup Pipeline ‚úÖ COMPLETE
- **GitHub:** Auto-push on changes (warrior7702/B.O.B)
- **OneDrive:** `FBCA/B.O.B. Backup` synced via rsync
- **Schedule:** Daily at 2 AM via cron
- **Script:** `backup.sh` with manifest generation

### Cross-Instance Polling ‚úÖ RUNNING
- **B.O.B. poller:** Active (PID 57528), checks every 30 seconds
- **Cornerstone poller:** Instructions sent, waiting for him to start
- **Status:** Test messages exchanged, full duplex ready

### Mission Control Updates
- **Favicon:** ü¶¶ otter icon added to browser tab
- **Port:** Locked to 3000 (killed zombies)
- **Status:** Running at http://localhost:3000

### Cost Tracking
- **Current model:** `ollama/llama3.1` (FREE)
- **Today's API costs:** $0.00
- **CodexBar:** ‚ùå FAILED - ARM-only (M1/M2/M3), incompatible with Intel Mac
  - Alternative: Build simple cost tracker script or skip (Ollama is free anyway)

### Key Decisions Made Today
1. **Convex over direct API** ‚Äî Avoided gateway bind hell
2. **Separate pollers per agent** ‚Äî Each checks for their own messages
3. **Stay on free Ollama** ‚Äî No paid fallbacks
4. **Skip CodexBar** ‚Äî Intel Mac incompatible, not critical

### Lessons Learned
1. **Gateway bind config caching** ‚Äî plist ignores config file changes
2. **Telegram bots can't DM each other** ‚Äî Need shared database (Convex)
3. **Both sides need polling** ‚Äî Can't push, must pull
4. **Schema conflicts** ‚Äî Cornerstone had existing tables, had to adapt
5. **Free first works** ‚Äî Zero API costs today

### Active Blockers
1. **Cornerstone poller not started** ‚Äî Instructions sent via Convex, waiting for him
2. **Ollama on Cornerstone's M1** ‚Äî He asked for setup help, provided instructions

### Tomorrow's Options
- **C:** Church Tech Projects (PCO, WordPress automation)
- **Finish:** Test full duplex once Cornerstone starts poller
- **Polish:** Git + OneDrive backup verification

---
**Status:** 90%+ research tasks complete. Critical (P1-P3): 100% ‚úÖ | Overall: ~90% ‚úÖ
**Session end:** 11:11 PM CT | **Model:** ollama/llama3.1 (FREE) | **Costs today:** $0.00
